<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>TheMaxLevelReturner</title>
    <style>
      /* 1. 기본 스타일: 검은 배경, 스크롤 제거 */
      html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: #000000;
      }
      /* 2. 캔버스 스타일: 중앙 정렬을 위해 absolute 사용 */
      #unity-canvas {
        position: absolute;
        background-color: #231F20;
      }
      /* 로딩 바 스타일 (필요 없다면 삭제 가능) */
      #unity-loading-bar { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); display: none; }
      #unity-logo { width: 154px; height: 130px; background: url('unity-logo-dark.png') no-repeat center; }
      #unity-progress-bar-empty { width: 141px; height: 18px; margin-top: 10px; background: url('progress-bar-empty-dark.png') no-repeat center; }
      #unity-progress-bar-full { width: 0%; height: 18px; margin-top: 10px; background: url('progress-bar-full-dark.png') no-repeat center; }
    </style>
  </head>
  <body>
    <canvas id="unity-canvas" width=1080 height=1920></canvas>
    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>
    </div>
    
    <script>
      // =========================================================
      // [커스텀] 화면 비율 유지 리사이징 로직
      // =========================================================
      
      // 1. 게임의 원본 해상도 비율 계산 (Unity 설정값 가져오기)
      // 만약 고정 비율을 원하면 1920/1080 처럼 직접 숫자를 넣어도 됨
      // Unity 템플릿 치환( 1080, 1920 )이 적용되지 않은 상태에서도
      // JS 문법 오류가 나지 않도록 문자열로 감싸고 숫자로 파싱한다.
      var _unityW = Number.parseFloat("1080");
      var _unityH = Number.parseFloat("1920");
      var targetAspect = (_unityW > 0 && _unityH > 0) ? (_unityW / _unityH) : (16 / 9);

      function resizeGame() {
        var canvas = document.querySelector("#unity-canvas");
        var windowWidth = window.innerWidth;
        var windowHeight = window.innerHeight;
        var windowRatio = windowWidth / windowHeight;
        
        var newWidth, newHeight;

        // 브라우저가 게임보다 가로로 더 긴 경우 (좌우 레터박스)
        if (windowRatio > targetAspect) {
          newHeight = windowHeight;
          newWidth = newHeight * targetAspect;
        } 
        // 브라우저가 게임보다 세로로 더 긴 경우 (상하 레터박스)
        else {
          newWidth = windowWidth;
          newHeight = newWidth / targetAspect;
        }

        // 크기 적용
        canvas.style.width = newWidth + "px";
        canvas.style.height = newHeight + "px";
        
        // 중앙 정렬
        canvas.style.left = (windowWidth - newWidth) / 2 + "px";
        canvas.style.top = (windowHeight - newHeight) / 2 + "px";
      }

      window.addEventListener('resize', resizeGame);
      resizeGame(); // 초기 실행
      // =========================================================

      // Unity 로더 스크립트
      var buildUrl = "Build";
      var loaderUrl = buildUrl + "/WebGL_Dev_1.0.150_370.loader.js";
      var config = {
        dataUrl: buildUrl + "/WebGL_Dev_1.0.150_370.data",
        frameworkUrl: buildUrl + "/WebGL_Dev_1.0.150_370.framework.js",
        codeUrl: buildUrl + "/WebGL_Dev_1.0.150_370.wasm",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DOTTWO",
        productName: "TheMaxLevelReturner",
        productVersion: "0.1.0",
      };

      // Unity 템플릿 치환 전 상태에서도(예: IDE 미리보기) JS 문법 오류가 나지 않도록
      // 전처리 지시문(#if/#endif)을 제거하고, 실제 파일명이 치환된 경우에만 옵션을 주입한다.
      var _memoryFileName = "";
      if (_memoryFileName && !_memoryFileName.includes("{")) {
        config.memoryUrl = buildUrl + "/" + _memoryFileName;
      }
      var _symbolsFileName = "";
      if (_symbolsFileName && !_symbolsFileName.includes("{")) {
        config.symbolsUrl = buildUrl + "/" + _symbolsFileName;
      }

      var container = document.querySelector("#unity-container");
      var canvas = document.querySelector("#unity-canvas");
      var loadingBar = document.querySelector("#unity-loading-bar");
      var progressBarFull = document.querySelector("#unity-progress-bar-full");

      loadingBar.style.display = "block";

      var script = document.createElement("script");
      script.src = loaderUrl;
      script.onload = () => {
        createUnityInstance(canvas, config, (progress) => {
          progressBarFull.style.width = 100 * progress + "%";
        }).then((unityInstance) => {
          loadingBar.style.display = "none";
          resizeGame(); // 게임 로드 완료 후 한번 더 리사이징
        }).catch((error_) => {
          alert(error_);
        });
      };
      document.body.appendChild(script);
    </script>
  </body>
</html>
